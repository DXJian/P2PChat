(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{EEjZ:function(e,t,a){"use strict";a.r(t);var i=a("o0o1"),r=a.n(i),s=a("g+26"),n=a("L2JU"),o=a("rK9G"),c=a("IF94"),l=a("+QIf"),p=a("YZAB");function d(e,t,a,i,r,s,n){try{var o=e[s](n),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(i,r)}function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){y(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f={extends:s.a,components:{StripeElementCard:o.StripeElementCard,BCard:c.a,BTabs:l.a,BTab:p.a},data:function(){return{formData:{frequency:null,currency:null,amount:0,payableAmount:0,creditBalance:0,applicableDate:null,oldExpiryDate:null,expiryDate:null,source:null,token:null,charge:null,orgName:"",addressLine1:"",addressLine2:"",city:"",state:"",country:"",zipcode:""},formLabels:{frequency:$t("membership.props.frequency"),currency:$t("config.system.currency"),amount:$t("membership.props.amount"),payableAmount:$t("membership.props.payable_amount"),creditBalance:$t("membership.props.credit_balance"),expiryDate:$t("membership.props.expiry_date"),newExpiryDate:$t("membership.props.new_expiry_date"),applicableDate:$t("membership.props.applicable_date"),orgName:$t("membership.props.org_name"),addressLine1:$t("membership.props.address_line_1"),addressLine2:$t("membership.props.address_line_2"),city:$t("membership.props.city"),state:$t("membership.props.state"),country:$t("membership.props.country"),zipcode:$t("membership.props.zipcode")},showPaymentOptions:!0,initialSetupCompleted:!1,paypalConfig:{},paypalButtons:null,paypalButtonsHasRendered:!1,paddleConfig:{},activePGTab:0,loading:!1,pageTitle:$t("membership.start_membership"),initUrl:"membership"}},computed:u(u(u({},Object(n.c)("common",["entity"])),Object(n.c)("user",["hasActiveMembership","membershipExpiryDate","hasLifetimeMembership","email"])),{},{preRequisiteEntity:function(){return this.entity},isBusy:function(){return!(this.entity&&!this.isLoading)},computedFrequency:{get:function(){return this.formData.frequency?this.formData.frequency.name:null},set:function(e){this.formData.frequency=this.preRequisiteEntity.frequencies.find((function(t){return t.name===e})),this.getCalculatedAmount()}},computedCurrency:{get:function(){return this.formData.currency?this.formData.currency.name:null},set:function(e){this.formData.currency=this.preRequisiteEntity.currencies.find((function(t){return t.name===e})),this.getCalculatedAmount(),this.preRequisiteEntity.paymentGateways.length&&"paypal"===this.preRequisiteEntity.paymentGateways[this.computedActiveTab].name&&(!0===this.paypalConfig.loaded?this.paypalScriptLoaded():this.loadPaypal()),this.preRequisiteEntity.paymentGateways.length&&"paddle"===this.preRequisiteEntity.paymentGateways[this.computedActiveTab].name&&(!0===this.paddleConfig.loaded?this.paddleScriptLoaded():this.loadPaddle())}},computedPricingForPaddle:function(){return[this.computedCurrency?"".concat(this.computedCurrency,":").concat(this.payableAmount):"USD:".concat(this.payableAmount)]},stripeConfig:function(){return this.entity&&this.entity.paymentGateways.length?this.entity.paymentGateways[0]:{}},stripeStyle:function(){return{empty:{"::placeholder":{color:"#adb5c0"},":focus":{"::placeholder":{color:"#ced4dd"}}}}},payableAmount:function(){return this.formData.amount},computedActiveTab:{get:function(){return this.activePGTab},set:function(e){this.activePGTab=e,this.preRequisiteEntity.paymentGateways.length&&"paypal"===this.preRequisiteEntity.paymentGateways[e].name?!1===this.paypalConfig.loaded?this.loadPaypal():this.paypalScriptLoaded():(this.paypalConfig.loaded&&this.paypalButtons&&this.paypalButtons.close&&(this.paypalButtons.close(),this.paypalButtonsHasRendered=!1),this.preRequisiteEntity.paymentGateways.length&&"paddle"===this.preRequisiteEntity.paymentGateways[e].name&&(!1===this.paddleConfig.loaded?this.loadPaddle():this.paddleScriptLoaded()))}}}),watch:{preRequisiteEntity:function(e){e&&(this.formData.frequency=e.frequencies?e.frequencies[0]:null)}},methods:u(u({},Object(n.b)("user",["GetUser"])),{},{getCalculatedAmount:function(e){var t=this;this.initialSetupCompleted&&(this.isLoading=!0,this.formData.method=this.preRequisiteEntity&&this.preRequisiteEntity.paymentGateways&&this.preRequisiteEntity.paymentGateways.length?this.preRequisiteEntity.paymentGateways[this.computedActiveTab].name:null,this.Custom({url:"membership/calculate",method:"post",data:this.formData}).then((function(a){t.formData.amount=a.amount||0,t.formData.applicableDate=a.applicableDate,t.formData.oldExpiryDate=a.expiryDate,t.formData.expiryDate=a.newExpiryDate,t.formData.paddleUrl=a.paddleUrl,t.isLoading=!1,e&&_.isFunction(e)?e():t.preRequisiteEntity&&t.preRequisiteEntity.paymentGateways.length&&"paddle"===t.preRequisiteEntity.paymentGateways[t.computedActiveTab].name&&(!0===t.paddleConfig.loaded?(Paddle&&Paddle.Checkout,t.paddleScriptLoaded()):t.loadPaddle())})).catch((function(e){t.isLoading=!1,formUtil.handleErrors(e)})))},updateMembership:function(){var e=this;this.isLoading=!0,this.Custom({url:"membership",method:"post",data:this.formData}).then((function(t){e.$toasted.success(t.message,e.$toastConfig),e.GetUser().then((function(t){e.$router.push({name:"appMembershipList",query:{reload:!0}}),e.isLoading=!1})).catch((function(t){formUtil.handleErrors(t),e.$router.push({name:"appMembershipList",query:{reload:!0}}),e.isLoading=!1}))})).catch((function(t){e.isLoading=!1,formUtil.handleErrors(t)}))},proceed:function(){this.formData.amount?(this.isLoading=!0,this.$refs&&this.$refs.stripeRef&&this.preRequisiteEntity.paymentGateways.length&&"stripe"===this.preRequisiteEntity.paymentGateways[this.computedActiveTab].name?this.$refs.stripeRef[0].submit():this.isLoading=!1):this.updateMembership()},stripeTokenCreated:function(e){this.formData.token=e,this.formData.method=this.preRequisiteEntity.paymentGateways.length&&this.preRequisiteEntity.paymentGateways[this.computedActiveTab].name,this.formData.charge={source:e.id,amount:100*this.payableAmount},this.formData.payableAmount=this.formData.charge.amount,this.updateMembership()},paypalScriptLoaded:function(){var e,t,a=this;this.loading=!0,this.isLoading=!0,this.paypalButtons&&this.paypalButtons.close&&this.paypalButtonsHasRendered&&(this.paypalButtons.close(),this.paypalButtonsHasRendered=!1),this.paypalButtons=window.paypal.Buttons({createOrder:function(e,t){a.isLoading=!0;var i={purchase_units:[{description:"".concat(window.kmenv.name," - ").concat(a.computedFrequency.name," ").concat($t("membership.membership")),amount:{currency_code:a.computedCurrency,value:a.payableAmount}}]};return t.order.create(i)},onApprove:(e=r.a.mark((function e(t,i){var s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.order.capture();case 2:s=e.sent,a.formData.token=s,a.formData.method=a.preRequisiteEntity.paymentGateways.length?a.preRequisiteEntity.paymentGateways[a.computedActiveTab].name:null,a.formData.charge={source:s.id,amount:a.payableAmount},a.formData.payableAmount=a.formData.charge.amount,a.isLoading=!1,a.updateMembership();case 9:case"end":return e.stop()}}),e)})),t=function(){var t=this,a=arguments;return new Promise((function(i,r){var s=e.apply(t,a);function n(e){d(s,i,r,n,o,"next",e)}function o(e){d(s,i,r,n,o,"throw",e)}n(void 0)}))},function(e,a){return t.apply(this,arguments)}),onError:function(e){a.isLoading=!1,a.$toasted.error(a.$t("membership.paypal_create_order_error"),a.$toastConfig.error)}}),this.paypalButtons.render(this.$refs.paypalRef[0]).then((function(){a.paypalButtonsHasRendered=!0})).catch((function(e){var t=a.$refs.paypalRef[0];if(t&&t.children.length>0)throw new Error(e);a.$toasted.info($t("general.kindly_reload_page"),a.$toastConfig.info)})),this.paypalConfig.loaded=!0,this.loading=!1,this.isLoading=!1},paddleScriptLoaded:function(){var e=this;Paddle&&(this.paddleConfig.mode||Paddle.Environment.set("sandbox"),Paddle.Setup({vendor:this.paddleConfig.key}),this.getCalculatedAmount((function(){Paddle.Checkout.open({method:"inline",email:e.email,country:e.formData.country,postcode:e.formData.zipcode,allowQuantity:!1,disableLogout:!0,frameTarget:"paddle-container",frameInitialHeight:416,frameStyle:"width:100%; min-width:312px; background-color: transparent; border: none;",override:e.formData.paddleUrl,successCallback:function(t){e.formData.token=t.checkout,e.formData.method=e.preRequisiteEntity.paymentGateways.length&&e.preRequisiteEntity.paymentGateways[e.computedActiveTab].name,e.formData.charge={source:t.checkout.id,amount:e.payableAmount},e.formData.payableAmount=e.formData.charge.amount,e.updateMembership()}}),e.paddleConfig.loaded=!0})))},loadPaypal:function(){var e=document.createElement("script");e.src="https://www.paypal.com/sdk/js?client-id="+this.paypalConfig.key+"&currency="+this.computedCurrency,e.addEventListener("load",this.paypalScriptLoaded),document.body.appendChild(e)},loadPaddle:function(){var e=document.createElement("script");e.src="https://cdn.paddle.com/paddle/paddle.js",e.addEventListener("load",this.paddleScriptLoaded),document.body.appendChild(e)}}),mounted:function(){var e=this;this.hasActiveMembership?this.pageTitle=$t("membership.extend_membership"):this.pageTitle=this.membershipExpiryDate?$t("membership.renew_membership"):$t("membership.start_membership"),this.applyPageHeader(),this.formData.currency=this.configs.system.currency,this.formData.orgName=this.configs.basic.orgName||"",this.formData.addressLine1=this.configs.basic.orgAddressLine1||"",this.formData.addressLine2=this.configs.basic.orgAddressLine2||"",this.formData.city=this.configs.basic.orgCity||"",this.formData.state=this.configs.basic.orgState||"",this.formData.country=this.configs.basic.orgCountry||"",this.formData.zipcode=this.configs.basic.orgZipcode||"",this.preRequisiteEntity?(this.formData.frequency=this.preRequisiteEntity.selectedFrequency?this.preRequisiteEntity.selectedFrequency:this.preRequisiteEntity.frequencies?this.preRequisiteEntity.frequencies[0]:null,this.formData.currency=this.preRequisiteEntity.selectedCurrency?this.preRequisiteEntity.selectedCurrency:this.preRequisiteEntity.currencies?this.preRequisiteEntity.currencies[0]:null,this.preRequisiteEntity.paymentGateways.length&&(this.paypalConfig=this.preRequisiteEntity.paymentGateways.find((function(e){return"paypal"===e.name})),this.paypalConfig&&(this.paypalConfig.loaded=!1,"paypal"===this.preRequisiteEntity.paymentGateways[this.computedActiveTab].name&&this.loadPaypal()),this.paddleConfig=this.preRequisiteEntity.paymentGateways.find((function(e){return"paddle"===e.name})),this.paddleConfig&&(this.paddleConfig.loaded=!1,"paddle"===this.preRequisiteEntity.paymentGateways[this.computedActiveTab].name&&this.loadPaddle())),this.initialSetupCompleted=!0,window.setTimeout((function(){e.getCalculatedAmount()}),1e3)):this.initialSetupCompleted=!0}},h=(a("yj3I"),a("KHd+")),b=Object(h.a)(f,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-container",{attrs:{boxed:"","min-height":"full","has-form":"","has-footer":""}},[a("form",{on:{submit:function(t){return t.preventDefault(),e.proceed.apply(null,arguments)}}},[a("animated-loader",{attrs:{"is-loading":e.isBusy,"loader-color":e.vars.loaderColor}}),e._v(" "),e.entity?[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-md-4 mb-4"},[a("label",{staticClass:"d-block text-muted"},[e._v(e._s(e.formLabels.currency))]),e._v(" "),a("div",[e._v("\n                        "+e._s(e.computedCurrency)+"\n                    ")])]),e._v(" "),a("div",{staticClass:"col-12 col-md-4 mb-4 text-md-center"},[a("label",{staticClass:"d-block text-muted"},[e._v(e._s(e.formLabels.frequency))]),e._v(" "),a("div",{staticClass:"d-flex align-items-center justify-content-md-center flex-wrap"},[e._l(e.preRequisiteEntity.frequencies,(function(t){return[a("base-radio",{key:t.name,staticClass:"mr-3 ml-0 mt-2",attrs:{value:t.name,inline:""},model:{value:e.computedFrequency,callback:function(t){e.computedFrequency=t},expression:"computedFrequency"}},[e._v("\n                                "+e._s(t.name)+"\n                            ")])]}))],2)]),e._v(" "),a("div",{staticClass:"col-12 col-md-4 mb-4 mt-2 text-md-right"},[a("view-date",{attrs:{label:e.formLabels.expiryDate,value:e.formData.oldExpiryDate}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4 mb-4 mt-2 d-none d-lg-block"}),e._v(" "),a("div",{staticClass:"col-12 col-md-4 mb-4 mt-2 text-md-center"},[a("view-date",{attrs:{label:e.formLabels.applicableDate,value:e.formData.applicableDate}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4 mb-4 mt-2 text-md-right"},[a("view-date",{attrs:{label:e.formLabels.newExpiryDate,value:e.formData.expiryDate}})],1)]),e._v(" "),e.formData.currency&&e.formData.frequency?a("div",{staticClass:"mb-4 mt-2"},[a("div",{staticClass:"text-md-right"},[a("view-currency",{attrs:{label:e.formLabels.amount,value:e.formData.amount,currency:e.formData.currency,tag:"h5","data-classes":"text-success"}})],1),e._v(" "),a("div",{staticClass:"text-md-right"},[a("view-currency",{attrs:{label:e.formLabels.payableAmount,value:e.payableAmount,currency:e.formData.currency,tag:"h2","data-classes":"text-success font-weight-600"}})],1)]):e._e(),e._v(" "),a("h5",{staticClass:"mb-2 mt-1 pb-2 border-bottom"},[e._v(e._s(e.$t("membership.props.billing_address")))]),e._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("base-input",{attrs:{label:e.formLabels.orgName,type:"text",error:e.formErrors.orgName},on:{"update:error":function(t){return e.$set(e.formErrors,"orgName",t)}},model:{value:e.formData.orgName,callback:function(t){e.$set(e.formData,"orgName",t)},expression:"formData.orgName"}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4"},[a("base-input",{attrs:{label:e.formLabels.addressLine1,type:"text",error:e.formErrors.addressLine1},on:{"update:error":function(t){return e.$set(e.formErrors,"addressLine1",t)}},model:{value:e.formData.addressLine1,callback:function(t){e.$set(e.formData,"addressLine1",t)},expression:"formData.addressLine1"}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4"},[a("base-input",{attrs:{label:e.formLabels.addressLine2,type:"text",error:e.formErrors.addressLine2},on:{"update:error":function(t){return e.$set(e.formErrors,"addressLine2",t)}},model:{value:e.formData.addressLine2,callback:function(t){e.$set(e.formData,"addressLine2",t)},expression:"formData.addressLine2"}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4"},[a("base-input",{attrs:{label:e.formLabels.city,type:"text",error:e.formErrors.city},on:{"update:error":function(t){return e.$set(e.formErrors,"city",t)}},model:{value:e.formData.city,callback:function(t){e.$set(e.formData,"city",t)},expression:"formData.city"}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4"},[a("base-input",{attrs:{label:e.formLabels.state,type:"text",error:e.formErrors.state},on:{"update:error":function(t){return e.$set(e.formErrors,"state",t)}},model:{value:e.formData.state,callback:function(t){e.$set(e.formData,"state",t)},expression:"formData.state"}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4"},[a("base-input",{attrs:{label:e.formLabels.country,type:"text",error:e.formErrors.country},on:{"update:error":function(t){return e.$set(e.formErrors,"country",t)}},model:{value:e.formData.country,callback:function(t){e.$set(e.formData,"country",t)},expression:"formData.country"}})],1),e._v(" "),a("div",{staticClass:"col-12 col-md-4"},[a("base-input",{attrs:{label:e.formLabels.zipcode,type:"text",error:e.formErrors.zipcode},on:{"update:error":function(t){return e.$set(e.formErrors,"zipcode",t)}},model:{value:e.formData.zipcode,callback:function(t){e.$set(e.formData,"zipcode",t)},expression:"formData.zipcode"}})],1)]),e._v(" "),a("br"),e._v(" "),e.showPaymentOptions?a("div",[a("b-card",{attrs:{"no-body":""}},[a("b-tabs",{attrs:{pills:"",card:"",vertical:"",lazy:"","active-nav-item-class":"font-weight-bold py-2","nav-wrapper-class":"col-12 col-md-4 col-lg-3 border-right"},model:{value:e.computedActiveTab,callback:function(t){e.computedActiveTab=t},expression:"computedActiveTab"}},e._l(e.entity.paymentGateways,(function(t){return a("b-tab",{key:t.name,attrs:{title:t.label,"title-item-class":"p-0"}},["stripe"===t.name?a("stripe-element-card",{ref:"stripeRef",refInFor:!0,attrs:{pk:e.stripeConfig.key,amount:100*e.payableAmount,locale:e.configs.system.locale,"style-object":e.stripeStyle},on:{token:e.stripeTokenCreated,loading:function(t){e.loading=t}}}):e._e(),e._v(" "),"paypal"===t.name?a("div",{ref:"paypalRef",refInFor:!0},[a("animated-loader",{attrs:{"is-loading":!e.paypalConfig.loaded&&1===e.computedActiveTab&&!e.isBusy,"loader-color":e.vars.loaderColor}})],1):e._e(),e._v(" "),"paddle"===t.name?a("div",{staticClass:"paddle-container"},[a("animated-loader",{attrs:{"is-loading":!e.paddleConfig.loaded&&2===e.computedActiveTab&&!e.isBusy,"loader-color":e.vars.loaderColor}})],1):e._e()],1)})),1)],1)],1):e._e()]:e._e(),e._v(" "),a("div",{staticClass:"form-footer mt-3"},[a("div",{staticClass:"left-side"},[a("base-button",{attrs:{type:"button",design:"light",tabindex:"-1"},on:{click:function(t){return e.$router.push({name:"appMembershipList",query:{reload:!0}})}}},[a("i",{staticClass:"fas fa-chevron-left"}),e._v(" "+e._s(e.$t("general.cancel")))])],1),e._v(" "),a("div",{staticClass:"right-side"},[0===e.computedActiveTab?a("base-button",{attrs:{type:"submit",design:"primary"}},[e._v(e._s(e.$t("general.proceed"))+" "),a("i",{staticClass:"fas fa-chevron-right"})]):a("span",{staticClass:"text-muted"},[e._v(e._s(e.$t("membership.pay_to_proceed")))])],1)])],2)])}),[],!1,null,null,null);t.default=b.exports},L1Ty:function(e,t,a){var i=a("Y1fK");"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};a("aET+")(i,r);i.locals&&(e.exports=i.locals)},Y1fK:function(e,t,a){(t=e.exports=a("I1BE")(!1)).push([e.i,"@import url(https://fonts.googleapis.com/css?family=Muli:300,400,600,700,800,900);",""]),t.push([e.i,".base-container .StripeElement{border:1px solid #dee2e9!important}",""])},yj3I:function(e,t,a){"use strict";a("L1Ty")}}]);
//# sourceMappingURL=form.js.map?id=996392470260d900f5f5